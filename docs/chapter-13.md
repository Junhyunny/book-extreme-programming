
## 13. 테스트: 일찍, 자주, 자동화

결함은 효율적인 소프트웨어 개발에 필요한 신뢰를 파괴한다. 
고객은 소프트웨어를 신뢰할 수 있어야 한다. 
관리나는 진행 상황 보고서를 믿을 수 있어야 한다. 
프로그래머는 서로를 신뢰할 수 있어야 한다. 
결함은 이런 신뢰를 깨뜨린다. 
신뢰가 없으면 다른 누군가가 잘못했을 가능성에서 자신을 보호하느라 많은 시간을 소모한다. 

결함은 언제나 존재한다. 
예상하지 못한 상황은 발생하기 마련이다. 
받아들일 수 있는 결함 수준은 다양하다. 

개발의 목표 

* 결함 발생을 경제적으로 감내할 수준까지 낮추는 것이다.
    * 인기 많은 홈페이지의 에러가 종종 발생하더라도 치명적이지 않다. 
    * 우주 왕복선의 소프트웨어 에러는 한 세기에 한번 발생하더라도 치명적이다.
* 신뢰가 합리적으로 자라날 수준까지 낮추는 것이다.
    * 결함 감소에 대한 투자는 팀워크에 대한 투자이다. 
    * 한 팀원이 저지른 실수가 다른 사람에게도 영향을 미쳐 팀의 시간, 에너지, 신뢰를 깎아 먹는다.

신뢰는 참여자들에게 활기를 불어넣는다. 
신뢰를 바탕으로 실험과 실수를 안전하게 할 수 있다. 
실험에 책임을 불어넣어서 우리가 아무런 해도 끼치지 않고 있음을 확신하려면 테스트가 필요하다. 

짝 프로그래밍은 결함을 감소시킨다. 
테스트도 결함에 직접 대응하는 기술적 활동이다. 
XP에서 테스트 비용 효율을 높이기 위해 두 가지 원칙을 적용한다. 

* 재확인(double check)
    * 테스트로 표현
    * 구현
    * 테스트의 표현과 구현의 결과가 일치하는 경우 코드가 올바를 가능성이 높아진다.
* 결함 비용 증가(defect cost increase, DCI)
    * 결함을 일찍 찾을수록 고치는 비용이 적게 든다. 
    * 예를 들어 배치한지 10년 뒤에 발견된 결함은 영향도, 코드의 역할, 코드의 역사 등 고려할 내용이 많아진다. 
    * 1분 전에 발견한 결함은 바로 고칠 수 있다.

피드백의 순환이 긴 소프트웨어 개발은 비용이 많이 들고 잔여 결함도 많다. 
결함을 발견하고 고치는데 할당되는 예산에는 한계가 있다. 
결함을 발견하고 고치는 비용이 더 들수록 배치된 코드에 더 많은 결함이 남게 된다. 

XP는 자동화된 테스트를 프로그래밍의 내부 순환에 넣어 결함을 더 일찍 더 적은 비용으로 고치려고 시도한다. 
동시대 기준으로 보면 매우 적은 결함만 지닌 소프트웨어를 적은 비용으로 개발할 기회를 준다. 

개발자가 테스트를 작성한다 해도 시스템에 대한 다른 시각은 계속 필요하다. 
한 명인 경우 자기 관점 한가지만 코드와 테스트에 반영한다. 
재확인은 전혀 다른 생각의 흐름이 동일한 결과를 내놓을 때 가장 제대로인 것이다. 
그래서 코드를 그대로 복사해서 그 것을 예상치로 삼는 것은 위험하다. 
다른 시각을 얻기 위해서는 예제 결과를 직접 손으로 계산하는 편이 좋다. 

XP 테스트의 즉각성(immediacy)은 테스트가 반드시 자동화여야 된다는 점을 의미한다. 
팀은 모든 테스트가 자동화되는 지점까지 테스트 자동화의 비용을 낮춰야 한다. 

스트레스 테스트나 부하(load) 테스트처럼 개발이 완료된 다음에 결함을 찾아보는 테스트 형태가 있다면, 그것들을 개발 주기 안으로 끌어들인다. 
부하 테스트와 스트레스 테스트도 꾸준히 자동화해서 돌린다. 

정적 테스트는 프로그램을 실행하기 전 소스코드 파싱하여 잠재적인 취약점을 발견하는 기법이다. 
코딩 규칙, 가이드 준수 여부를 검사한다. 
코드 실행 전에 사용한다. 

정적 검증도 유효한 재확인 형식이다. 
결힘들이 동적으로 재생산되기 어려운 경우 특히 유효하다. 
정적 검사가 가치 있으려면 반드시 검사 속도가 빨라야 한다. 
개발 내부 순환의 일부가 되어야 한다. 
정적 검사기들도 점진적인 컴파일러(incremental compiler)처럼 프로그램에 가해진 변화에 따라 몇 초만에 피드백을 내놓아야 한다. 

DCI에 따르면 테스트와 코딩 시섬은 가까워야 한다. 
테스트를 정확히 어느 시점에 해야할지 알려주지는 않는다. 
실제 세계에선 실체가 없기 때문에 구현 후 테스트를 하지만, 소프트웨어 세계는 그렇지 않다. 
코드와 테스트들은 어떤 순서로 작성해도 상관없다. 
XP에서 가능하다면 테스트를 구현보다 먼저 작성한다. 

소프트웨어 개발에서 인터페이스게 구현에 과도하게 영향을 받으면 안된다. 
테스트를 먼저 작성하는 것은 이런 분리를 이루는 구체적인 방법이다. 

테스트는 확실성에 대한 인간의 욕구를 충적시킨다. 
상상할 수 있는 실패 가능성들을 모두 시험하는 테스트를 작성하고, 이를 통과하면 자신의 코드가 올바르다고 확실히 믿을 수 있다. 
미처 상상하지 못한 테스트들은 혹시 실패할지도 모른다. 

테스트는 진전의 척도를 제공한다. 
실패하는 테스트를 하나씩 만들고, 한 번에 하나씩 통과시킨다. 
첫 번째 테스트를 통과게 만들면서 생긴 경험이 두 번째 테스트 작성에 도움을 준다. 
아직 검증되지 않은 가정을 바탕으로 테스트를 작성했다면, 가정이 잘못된 것으로 드러나는 경우 테스트를 모두 고쳐야 한다. 

XP에서 테스트는 프로그래밍만큼 중요하다. 

* 팀에게 스스로 자랑스럽게 여길 작업을 할 기회를 준다.
* 예상하지 못한 방향으로 팀이 빠른 속도로 움직일 때 자신감의 타당한 기반을 마련한다.
* 팀 내부의 신뢰와 고객과의 신뢰를 강화함으로써 개발에 기여한다. 
