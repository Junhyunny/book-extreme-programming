
##  14. 설계하기: 시간의 가치

점진적 설계는 고객에게 기능을 빨리 전달하고 프로젝트의 생애 내내 매주 계속 기능을 제공하기 위한 방법이다. 
XP는 설계의 점진성을 극한까지 밀어붙여, 설계가 매일 업무의 일부가 될 때 프로젝트가 더 순조롭게 진행된다고 주장한다. 

퍼머컬쳐(permaculture)는 균형 잡힌 생태계 속에서 지속 가능한 삶을 사는 철학과 실천방법이다. 
설계도 상생 관계를 가진 요소들의 시스템이다. 

* "요소"란 시스템을 오직 전체로만 이해해서는 완전히 이해할 수 없다는 것을 의미한다.
* "관계를 가진"이란 설계 안의 요소들이 홀로 있는 것이 아니고, 서로 관계를 맺음으로써 하나가 된다는 의미이다. 
* "상생"이란 요소들이 맺는 관계가 요소들을 강화해서 홀로 있을 때보다 더욱 강력하게 만든다는 의미이다.

설계는 소프트웨어를 가치있게 만든다. 
전혀 비용을 들이지 않고 요소들을 끝없이 복제할 수 있다. 
요소들 상이의 유용한 관계를 만들었다면, 이 관계를 기존 모든 요소들에게 전파할 수 있다. 
좋은 아이디어 하나가 몇 십억 원을 절약하고, 수백억이 넘는 수입을 창출할 수 있다. 

실제 세계에서는 각 단계의 비용이 너무 커서 점진적 설계를 유용하게 쓸 수 없다. 
이런 활동에서 온 메타포들이 소프트웨어 설계에 족쇄를 채운다. 

소프트웨어에서 점진적 설계가 가치 있는 이유

* 어떤 어플리케이션을 최초로 작성하는 경우가 많다.
* 동일 주제에 대해 무수히 많은 변화를 시도한 후에 나온 것이라 해도, 언제나 더 나은 방법이 존재한다.
* 설계가 미치는 영향은 증폭되므로 설계 아이디어들도 경험이 쌓이면서 개선된다.
* 피드백을 얻을 정도까지만 설계를 한다.
* 얻은 피드백을 이용해서 그 다음 피드백을 얻을 정도까지만 설계를 개선한다. 

건물 짓기를 메타포로 소프트웨어 개발을 설명하는 것은 좋지 않다. 
실제 건물을 지을 때 작업을 되돌리는 것은 굉장한 비용을 발생시킨다. 
소프트웨어는 하루 일을 되돌리는 것은 별 일이 아니다. 
소프트웨어에서 설계를 하느냐 마느냐가 아니라 언제 설계를 하느냐가 중요하다. 

초기 대형 설계(Big Designe Up Front)의 대안은 초기에 조금 설계하기(Little Design Up Front) 또는 초기에 충분히 설계하기(Enough Design Up Front)이다. 
최초 구현을 시작할 수 있는 정도만 설계하면 된다. 
그 이상의 설계는 구현이 자리를 잡고 설계의 진짜 제약들이 분명하게 보일 때 한다. 
"아무것도 설계하지 마라"와 정반대로 XP 전략은 "언제나 설계하라"이다.

설계 품질은 경험을 반영하여 설계할 때 가장 높아진다. 

* 직관으로 설계 - 가장 품질이 낮다.
* 사고로 설계 - 품질이 중간이다. 
* 경험을 반영한 설계 - 가장 품질이 높다. 

설계 문제 가운데 특히 중요한 문제는 데이터베이스 설게이다. 
우아한 점진적 데이터베이스 설계 전략을 소개한다. 

1. 빈 데이터베이스로 시작한다.
1. 테이블과 열은 모두 자동화된 스크립트를 통해서 추가한다. 
    * 이 스크립트는 필요한 경우 기존 데이터를 이전하는 일도 한다.
1. 스크립트에 순서대로 번호를 매겨서, 어떤 나중 단계에서는 스크립트만 돌리면 언제라도 이전 단계의 데이터베이스를 복원할 수 있도록 한다. 

코드의 특정 버전에는 데이터베이스 설계의 특정 버전이 필요하다. 
시스템의 새 버전을 배치하는 작업에는 새 코드를 설치하는 일과 설계/이전 스크립트가 있다면 그것을 돌리는 일도 포함된다. 
시스템 가동 중단 시간을 줄이려면 배치를 작고 잦게 유지한다. 

데이터나 구조 혹은 논리는 시스템에서 오직 한 곳에만 존재해야 한다. 
중복을 발견했다면 설계를 개선해야 한다. 
중복이 나쁜 이유는 개념의 변화를 하나 만들려면 코드 여러 곳을 고쳐야하기 때문이다. 
코드에 이런 특징이 있다면 지속적인 변화 비용은 계속 낮게 유지된다. 

점진적 설계에 대한 반대 의견은 두 가지가 있다. 

* 우린 못 해
    * 코드와 데이터가 계속 돌아가는 환경에서 설계하기 위해 필요한 기술들을 배우면 해결 가능하다.
* 우린 안 해
    * 설계를 개선할 가능성을 보고도 시스템에 적용할 시간을 내지 않는다.
    * 새 기능을 하나 추가하는 문제에 집중하여, 설계를 개선하지 않는다.
    * 제자리가 아닌 곳에 기능을 하나 더 넣을 때 불쾌함을 생각하지 않는다.
    * 일을 잘 해나갈 때 주는 만족감과 열의를 생각하지 않는다. 

설계 개선을 어떻게 진행할지 생각하는 것도 점진적 설계의 일부다. 

XP의 설계를 요약하면 다음과 같다.

* 경험을 바탕으로 설계할 수 있을 때까지 설계를 미룬다.
* 결정 내용을 즉각 사용할 수 있을 때까지 설계를 미룬다.

XP 설계를 통해 다음과 같은 것들을 얻을 수 있다.

* 소프트웨어를 더 빨리 배치할 수 있다.
* 확신을 가지고 결정을 내릴 수 있다.
* 잘못된 결정을 계속 끌어안고 사는 일을 피할 수 있다.
* 처음 설계할 때 내린 가정들이 다른 것으로 대체되더라도 개발 속도를 유지할 수 있다.

가치 있는 새로운 기능의 흐름을 유지하기 위해서는 프로젝트의 수명 내내 설계에 꾸준히 투자하고, 큰 변화를 작은 단계로 나누어 실행하는 훈련(discipline)이 필요하다.

XP 팀의 중요한 가치인 단순성을 지키기 위해 설계의 단순성을 평가하는 네 가지 기준이 있다.

* 대상이 되는 독자에게 적당
    * 멋지고 우아한지 중요하지 않다.
    * 설계를 가지고 일할 사람들이 이해하지 못한다면, 그들에게 단순하지 않은 설계이다.
* 정보 전달력
    * 의사소통할 필요가 있는 모든 생각은 시스템에 표현되어 있어야 한다.
    * 시스템의 요소들은 미래의 독자에게 의사를 전달한다.
* 리팩토링 유무
    * 중복된 논리나 구조가 있으면 코드를 이해하거나 수정하기 어렵다.
* 최소성
    * 위 세 가지 제약 안에서, 시스템 요소의 수를 할 수 있는 한 최소로 줄인다.
    * 요소 개수가 더 적다면 테스트, 문서화, 의사소통할 것이 적다는 의미이다.
